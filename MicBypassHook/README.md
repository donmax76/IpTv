# MicBypassHook

DLL-библиотека для скрытия использования микрофона путем перехвата вызовов Windows Audio API.

## Описание

Эта DLL использует библиотеку Microsoft Detours для перехвата функции `IAudioClient::Initialize` и замены GUID сессии на нулевой GUID (`GUID_NULL`). Это предотвращает регистрацию аудио-сессии в Windows, что скрывает использование микрофона от системы.

## Требования

1. **Visual Studio 2019 или новее** с компонентами:
   - Desktop development with C++
   - Windows 10/11 SDK

2. **Microsoft Detours 4.0.1** — уже включена в проект (`third_party/Detours`). Ничего дополнительно устанавливать не нужно.

3. **Windows 10/11** (x64)

## Подготовка окружения

Detours уже находится в репозитории (`MicBypassHook/third_party/Detours`). Никаких дополнительных шагов по установке не требуется. Если захотите обновить версию Detours, используйте `git submodule` или замените содержимое папки вручную.

## Сборка

### Способ 1: Через Visual Studio
1. Откройте `MicBypassHook.sln` в Visual Studio
2. Выберите конфигурацию: **Release** и платформу: **x64**
3. Build > Build Solution (или F7)
4. DLL будет в `bin\x64\Release\MicBypassHook.dll`

### Способ 2: Через командную строку
```cmd
cd MicBypassHook
BUILD.bat
```

### Способ 3: Через MSBuild напрямую
```cmd
msbuild MicBypassHook.sln /p:Configuration=Release /p:Platform=x64
```

## Использование

### Способ 1: Через DLL Injection
Используйте инструмент для инжекции DLL (например, `DLLInjector.exe` или `Process Hacker`):
```cmd
DLLInjector.exe YourApp.exe MicBypassHook.dll
```

### Способ 2: Через AppInit_DLLs (требует прав администратора)
1. Откройте реестр: `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows`
2. Установите `AppInit_DLLs` = полный путь к `MicBypassHook.dll`
3. Установите `LoadAppInit_DLLs` = `1`
4. Перезагрузите компьютер

**ВНИМАНИЕ:** AppInit_DLLs загружает DLL во все процессы, что может вызвать проблемы!

### Способ 3: Через SetWindowsHookEx (программно)
Создайте загрузчик, который инжектирует DLL в нужный процесс.

## Тестирование

1. Соберите DLL
2. Запустите ваше приложение для записи аудио
3. Инжектируйте DLL в процесс приложения
4. Проверьте, что индикатор микрофона не появляется в Windows

## Принцип работы

1. DLL перехватывает вызов `IAudioClient::Initialize`
2. Заменяет переданный `AudioSessionGuid` на `GUID_NULL`
3. Windows не регистрирует аудио-сессию, так как GUID нулевой
4. Индикатор микрофона не отображается

## Ограничения

- Работает только для приложений, использующих WASAPI через `IAudioClient`
- Требует инжекцию DLL в процесс приложения
- Может не работать с некоторыми защищенными приложениями (антивирусы, DRM)
- Требует права администратора для некоторых методов инжекции

## Безопасность

⚠️ **ВНИМАНИЕ:** Использование DLL-инжекции может нарушать политики безопасности и лицензионные соглашения некоторых приложений. Используйте на свой риск.

## Лицензия

Этот код предоставляется "как есть" без каких-либо гарантий.

